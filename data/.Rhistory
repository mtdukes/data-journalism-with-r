#load our packages from our library into our workspace
library(tidyverse)
#set working directory to the data folder of the downloaded repository
setwd("~/Dropbox/projects/duke/data_lab/data-journalism-with-r/data")
#set working directory to the data folder of the downloaded repository
setwd("~/Dropbox/projects/duke/data_lab/spring_2020/data-journalism-with-r/data/")
#install the tidyverse package
install.packages("tidyverse")
install.packages("tidyverse")
#load our packages from our library into our workspace
library(tidyverse)
ppp <- read_csv('public_150k_plus.csv')
View(ppp)
ppp1 <- read_csv('public_150k_plus.csv')
ppp2 <- read_csv('public_up_to_150k_1.csv')
rm(ppp)
ppp3 <- read_csv('public_up_to_150k_2.csv')
ppp4 <- read_csv('public_up_to_150k_3.csv')
ppp5 <- read_csv('public_up_to_150k_4.csv')
ppp6 <- read_csv('public_up_to_150k_5.csv')
View(ppp5)
View(ppp5)
View(ppp1)
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = col_double())
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = d)
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = 'd')
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = 'dc')
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = rep('d',50))
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = c(rep('d',50)))
rep('d',50)
paste(replicate(50, "d"), collapse = "")
ppp6 <- read_csv('public_up_to_150k_5.csv', col_types = paste(replicate(50, "d"), collapse = ""))
ppp6 <- read_csv('public_up_to_150k_5.csv')
ppp7 <- read_csv('public_up_to_150k_6.csv')
ppp6 <- read_csv('public_up_to_150k_5.csv', guess_max = 2000)
ppp <- rbind(
ppp1, ppp2
)
ppp <- rbind(ppp1, ppp2, ppp3, ppp4, ppp5, ppp6, ppp7)
#load in our data downloaded from
ppp1 <- read_csv('../originals/public_150k_plus.csv')
View(ppp)
ppp %>%
count(BorrowerState)
ppp %>%
count(BorrowerState) %>%
arrange(desc(n))
ppp %>%
count(BorrowerState) %>%
filter(BorrowerState == 'NC') %>%
arrange(desc(n))
ppp %>%
filter(BorrowerState == 'NC') %>%
write.csv('ppp_nc20210201.csv', row.names = FALSE)
rm(ppp)
rm(ppp1)
rm(ppp2)
rm(ppp3)
rm(ppp4)
rm(ppp5)
rm(ppp6)
rm(ppp7)
#load in our fresh data
ppp <- read_csv('ppp_nc20210201.csv')
View(ppp)
View(ppp)
View(ppp)
#how many rows do we have?
ppp %>%
nrow()
#are we only looking at NC?
ppp %>%
count(BorrowerState)
#what's our total loan value?
ppp %>%
summarize(total = sum(InitialApprovalAmount))
#what about the average?
#what's our total loan value?
ppp %>%
summarize(total = average(InitialApprovalAmount))
#what about the average?
#what's our total loan value?
ppp %>%
summarize(total = avg(InitialApprovalAmount))
#what about the average?
#what's our total loan value?
ppp %>%
summarize(avg = mean(InitialApprovalAmount))
#what's the typical value/median?
#what's our total loan value?
ppp %>%
summarize(total = median(InitialApprovalAmount))
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount))
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
head()
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
head() %>%
kable('simple')
install.packages("knitr")
library(knitr)
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
head() %>%
kable('simple')
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
head()
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
select(BorrowerName, BorrowerCity, InitialApprovalAmount) %>%
head() %>%
kable('simple')
options(scipen=999)
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
select(BorrowerName, BorrowerCity, InitialApprovalAmount) %>%
head() %>%
kable('simple')
#who got the largest loan?
ppp %>%
arrange(desc(InitialApprovalAmount)) %>%
select(BorrowerName, BorrowerCity, InitialApprovalAmount) %>%
head() %>%
kable('simple')
#who got the smallest loan?
ppp %>%
arrange(InitialApprovalAmount) %>%
select(BorrowerName, BorrowerCity, InitialApprovalAmount) %>%
head() %>%
kable('simple')
#give me a rundown of the column names
ppp %>%
names()
ppp %>%
count(ProjectState)
# Cleaning and grouping ---------------------------------------------------
ppp %>%
count(ProjectCountyName)
# Cleaning and grouping ---------------------------------------------------
ppp %>%
count(ProjectCountyName, name = loan_count) %>%
arrange(desc(loan_count))
# Cleaning and grouping ---------------------------------------------------
ppp %>%
count(ProjectCountyName, name = 'loan_count') %>%
arrange(desc(loan_count))
# Cleaning and grouping ---------------------------------------------------
ppp %>%
count(ProjectCountyName, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#group by city
ppp %>%
count(ProjectCityName, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#group by city
ppp %>%
count(ProjectCity, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
#and regroup by city on the clean column
ppp %>%
count(ProjectCity_clean, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
#and regroup by city on the clean column
ppp %>%
count(ProjectCity_clean, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(address_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
install.packages("stringr")
library(stringr)
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(address_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(address_clean, '\\.'))
#group by city
ppp %>%
count(ProjectCity, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#load our packages from our library into our workspace
library(tidyverse)
library(knitr)
library(stringr)
#group by city
ppp %>%
count(ProjectCity, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(address_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(ProjectCity_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
#and regroup by city on the clean column
ppp %>%
count(ProjectCity_clean, name = 'loan_count') %>%
arrange(desc(loan_count)) %>%
kable('simple')
#load in our naics code lookups
ppp <- read_csv('naics_lookup.csv')
#load in our fresh data
ppp <- read_csv('ppp_nc20210201.csv')
#load in our naics code lookups
naics <- read_csv('naics_lookup.csv')
#clean up the city name just by normalizing the capitalization
ppp <- ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(ProjectCity_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
View(naics)
ppp %>%
mutate(naics_initial_code = strtoi(substr(NAICSCode, start = 1, stop = 2))) %>%
left_join(naics, by = c('naics_initial_code')) %>%
group_by(naics_title) %>%
summarize(total = sum(LoanAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
library(janitor)
ppp %>%
mutate(naics_initial_code = strtoi(substr(NAICSCode, start = 1, stop = 2))) %>%
left_join(naics, by = c('naics_initial_code')) %>%
group_by(naics_title) %>%
summarize(total = sum(LoanAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
ppp %>%
mutate(naics_initial_code = strtoi(substr(NAICSCode, start = 1, stop = 2))) %>%
left_join(naics, by = c('naics_initial_code')) %>%
group_by(naics_title) %>%
summarize(total = sum(InitialApprovalAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
ppp <- ppp %>%
mutate(NAICS_initial = strtoi(substr(NAICSCode, start = 1, stop = 2)))
ppp %>%
left_join(naics,
by = c('NAICS_initial')
) %>%
group_by(naics_title) %>%
summarize(total = sum(InitialApprovalAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
) %>%
group_by(naics_title) %>%
summarize(total = sum(InitialApprovalAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
ppp < - ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
) %>%
relocate(NAICS_initial, .after = NAICSCode)
ppp < - ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
) %>%
relocate(NAICS_initial, .after = NAICSCode)
ppp %>%
mutate(ProjectCity_clean = toupper(ProjectCity)) %>%
mutate(ProjectCity_clean = str_remove_all(ProjectCity_clean, '\\.')) %>%
relocate(ProjectCity_clean, .after = ProjectCity)
ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
)
ppp < - ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
)
ppp <- ppp %>%
mutate(NAICS_initial = strtoi(substr(NAICSCode, start = 1, stop = 2)))
ppp < - ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
)
#load in our fresh data
ppp <- read_csv('ppp_nc20210201.csv')
ppp <- ppp %>%
mutate(NAICS_initial = strtoi(substr(NAICSCode, start = 1, stop = 2))) %>%
relocate(NAICS_initial, .after = NAICSCode)
View(ppp)
ppp < - ppp %>%
left_join(naics,
by = c('NAICS_initial' = 'naics_initial_code')
)
#load in our fresh data
ppp <- read_csv('ppp_nc20210201.csv')
ppp <- ppp %>%
mutate(naics_initial_code = strtoi(substr(NAICSCode, start = 1, stop = 2))) %>%
relocate(naics_initial_code, .after = NAICSCode)
ppp_nc %>%
left_join(naics, by = c('naics_initial_code')) %>%
group_by(naics_title) %>%
summarize(total = sum(LoanAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
ppp %>%
left_join(naics, by = c('naics_initial_code')) %>%
group_by(naics_title) %>%
summarize(total = sum(InitialApprovalAmount)) %>%
arrange(desc(total)) %>%
adorn_totals() %>%
adorn_percentages('col') %>%
adorn_pct_formatting() %>%
adorn_ns(position = "front") %>%
kable('simple')
